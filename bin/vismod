#!/usr/bin/env python
from pathlib import Path
from os.path import dirname,abspath
from sys import path,argv
path.append(dirname(dirname(abspath(__file__))))
from csv import DictReader
from pandas import read_csv
from pickle import load,dump
from matplotlib.pyplot import plot,show,title,xlabel,ylabel,legend,ioff,xscale,yscale
ioff()
if len(argv)<4:
  print('Usage:',argv[0],'PRED_DIR LAB trn|tst [RESAMPLER]')
  exit(1)
pred_p=Path(argv[1])
ht_p=pred_p/'hashtab.csv'
rs=argv[4] if len(argv)==5 else ''

with ht_p.open('r') as fd:
  ls=list(DictReader(fd))

fs=[f for f in pred_p.iterdir() if argv[2] in f.stem and argv[3] in f.stem]
for h,p in [(l['hash'],l['params']) for l in ls if l['lab_cat']==argv[2] and\
            l['stage']==argv[3] and l['params'].split("'")[-2]==rs]:
  for tfp,tfn,f in sorted([(*(float(t) for t in f.stem.split('_')[2:4]),f)\
      for f in fs if h in f.stem],key=lambda x:-x[0]):
    with f.open('r') as fd:
      res=list(DictReader(fd))
    fps=[float(r['fp']) for r in res[1:-1]]
    fns=[float(r['fn']) for r in res[1:-1]]
    plot(fps,fns,label='tfp,tfn='+str(tfp)+','+str(tfn))
  xlabel('FP')
  ylabel('FN')
  xscale('log')
  yscale('log')
  legend()
  title(p)
  show()
