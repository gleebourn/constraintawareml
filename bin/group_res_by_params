#!/usr/bin/env python
from pandas import read_csv,unique,DataFrame,concat
from sys import argv
from functools import reduce
from csv import DictReader,DictWriter
from pathlib import Path

res={}
labs=['fp_target','fn_target','fp_train','fn_train','fp_test','fn_test']
with Path(argv[1]).open('r') as fd:
  rs=DictReader(fd)
  for r in rs:
    tfpfn=str(round(float(r['fp_target'])/float(r['fn_target']),1))
    res[r['params'],r['p'],r['resampler']]={**{l+'_'+tfpfn:r[l] for l in labs},
                                            **res.pop((r['params'],r['p'],r['resampler']),{})}
    print(res[r['params'],r['p'],r['resampler']])
with Path(argv[1]).with_stem('condensed').open('w') as fd:
  header=['params','p','resampler']+list(next(iter(res.values())))
  w=DictWriter(fd,header)
  w.writeheader()
  [w.writerow({'params':k[0],'p':k[1],'resampler':k[2],**v}) for k,v in res.items()]

